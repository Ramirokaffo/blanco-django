{% extends 'base.html' %}
{% load static %}

{% block title %}Trésorerie - {{ system_settings.company_name }}{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-content">
        <div>
            <h1>Tableau de bord Trésorerie</h1>
            <p class="text-secondary">Exercice : {{ exercise }} — Solde total : {{ total_treasury|floatformat:0 }} FCFA</p>
        </div>
        <div>
            <a href="{% url 'credit_sales' %}" class="btn btn-secondary btn-sm">Crédits clients</a>
            <a href="{% url 'supplier_payments' %}" class="btn btn-secondary btn-sm">Paiements fourn.</a>
            <a href="{% url 'accounting_journal' %}" class="btn btn-secondary btn-sm">Journal</a>
        </div>
    </div>
</div>

<!-- Cartes de soldes -->
<div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
    {% for ta in treasury_accounts %}
    <div class="card" style="padding: 1.25rem;">
        <div style="font-size: 0.85rem; color: var(--text-secondary, #6c757d);">{{ ta.account.code }} — {{ ta.account.name }}</div>
        <div style="font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;">{{ ta.balance|floatformat:0 }} <small style="font-size:0.7em;">FCFA</small></div>
    </div>
    {% endfor %}

    <!-- Créances clients -->
    <div class="card" style="padding: 1.25rem; border-left: 3px solid var(--warning, #f39c12);">
        <div style="font-size: 0.85rem; color: var(--text-secondary, #6c757d);">411 — Créances clients</div>
        <div style="font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem; color: var(--warning, #f39c12);">{{ clients_balance|floatformat:0 }} <small style="font-size:0.7em;">FCFA</small></div>
    </div>

    <!-- Dettes fournisseurs -->
    <div class="card" style="padding: 1.25rem; border-left: 3px solid var(--danger, #e74c3c);">
        <div style="font-size: 0.85rem; color: var(--text-secondary, #6c757d);">401 — Dettes fournisseurs</div>
        <div style="font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem; color: var(--danger, #e74c3c);">{{ suppliers_balance|floatformat:0 }} <small style="font-size:0.7em;">FCFA</small></div>
    </div>
</div>

<!-- Derniers paiements reçus -->
<div class="card" style="margin-bottom: 1.5rem;">
    <div class="card-header">
        <h3 class="card-title">Derniers paiements clients reçus</h3>
        <a href="{% url 'credit_sales' %}" class="btn btn-secondary btn-sm">Voir tout</a>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Client</th>
                        <th>Mode</th>
                        <th class="text-right">Montant</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in recent_payments %}
                    <tr>
                        <td>{{ p.payment_date|date:"d/m/Y" }}</td>
                        <td>{% if p.credit_sale.sale.client %}{{ p.credit_sale.sale.client.firstname }} {{ p.credit_sale.sale.client.lastname }}{% else %}-{% endif %}</td>
                        <td>{{ p.get_payment_method_display }}</td>
                        <td class="text-right">{{ p.amount|floatformat:0 }} FCFA</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4" class="text-center">Aucun paiement récent</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Derniers paiements fournisseurs -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Derniers paiements fournisseurs</h3>
        <a href="{% url 'supplier_payments' %}" class="btn btn-secondary btn-sm">Voir tout</a>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Fournisseur</th>
                        <th>Mode</th>
                        <th class="text-right">Montant</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sp in recent_supplier_payments %}
                    <tr>
                        <td>{{ sp.payment_date|date:"d/m/Y" }}</td>
                        <td>{{ sp.supplier.name }}</td>
                        <td>{{ sp.get_payment_method_display }}</td>
                        <td class="text-right">{{ sp.amount|floatformat:0 }} FCFA</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4" class="text-center">Aucun paiement récent</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

