{% extends 'base.html' %}
{% load static %}

{% block title %}D√©claration de TVA - {{ system_settings.company_name }}{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-content">
        <div>
            <h1>üìã D√©claration de TVA</h1>
            <p class="text-secondary">Exercice : {{ exercise }}</p>
        </div>
        <div>
            <a href="{% url 'reports' %}" class="btn btn-secondary btn-sm">Rapports</a>
        </div>
    </div>
</div>

<!-- R√©sum√© TVA -->
<div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
    <div class="card" style="padding: 1.25rem; border-left: 3px solid var(--success, #28a745);">
        <div style="font-size: 0.85rem; color: var(--text-secondary, #6c757d);">TVA collect√©e (4431)</div>
        <div style="font-size: 1.5rem; font-weight: 700; color: var(--success, #28a745);">{{ tva_collectee|floatformat:0 }} <small style="font-size:0.7em;">FCFA</small></div>
        <div style="font-size: 0.8rem; color: var(--text-secondary, #6c757d);">Sur ventes</div>
    </div>
    <div class="card" style="padding: 1.25rem; border-left: 3px solid var(--info, #17a2b8);">
        <div style="font-size: 0.85rem; color: var(--text-secondary, #6c757d);">TVA d√©ductible (4451)</div>
        <div style="font-size: 1.5rem; font-weight: 700; color: var(--info, #17a2b8);">{{ tva_deductible|floatformat:0 }} <small style="font-size:0.7em;">FCFA</small></div>
        <div style="font-size: 0.8rem; color: var(--text-secondary, #6c757d);">Sur achats</div>
    </div>
    <div class="card" style="padding: 1.25rem; border-left: 3px solid {% if tva_due >= 0 %}var(--danger, #e74c3c){% else %}var(--success, #28a745){% endif %};">
        <div style="font-size: 0.85rem; color: var(--text-secondary, #6c757d);">TVA due √† l'√âtat (4441)</div>
        <div style="font-size: 1.5rem; font-weight: 700; color: {% if tva_due >= 0 %}var(--danger, #e74c3c){% else %}var(--success, #28a745){% endif %};">
            {{ tva_due|floatformat:0 }} <small style="font-size:0.7em;">FCFA</small>
        </div>
        <div style="font-size: 0.8rem; color: var(--text-secondary, #6c757d);">{% if tva_due >= 0 %}√Ä reverser{% else %}Cr√©dit de TVA{% endif %}</div>
    </div>
</div>

<!-- D√©tail mensuel -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">D√©tail mensuel</h2>
    </div>
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>P√©riode</th>
                    <th class="text-right">TVA collect√©e</th>
                    <th class="text-right">TVA d√©ductible</th>
                    <th class="text-right">TVA due</th>
                </tr>
            </thead>
            <tbody>
                {% for m in monthly %}
                <tr>
                    <td>{{ m.month }}/{{ m.year }}</td>
                    <td class="text-right">{{ m.collectee|floatformat:0 }} FCFA</td>
                    <td class="text-right">{{ m.deductible|floatformat:0 }} FCFA</td>
                    <td class="text-right" style="font-weight: 600; color: {% if m.due >= 0 %}var(--danger, #e74c3c){% else %}var(--success, #28a745){% endif %};">
                        {{ m.due|floatformat:0 }} FCFA
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center text-secondary">Aucune op√©ration avec TVA pour cet exercice</td>
                </tr>
                {% endfor %}
            </tbody>
            {% if monthly %}
            <tfoot>
                <tr style="font-weight: 700; border-top: 2px solid var(--border-color, #dee2e6);">
                    <td>TOTAL</td>
                    <td class="text-right">{{ tva_collectee|floatformat:0 }} FCFA</td>
                    <td class="text-right">{{ tva_deductible|floatformat:0 }} FCFA</td>
                    <td class="text-right" style="color: {% if tva_due >= 0 %}var(--danger, #e74c3c){% else %}var(--success, #28a745){% endif %};">
                        {{ tva_due|floatformat:0 }} FCFA
                    </td>
                </tr>
            </tfoot>
            {% endif %}
        </table>
    </div>
</div>

<!-- Note explicative -->
<div class="card" style="margin-top: 1rem; padding: 1.25rem; background: var(--bg-secondary, #f8f9fa);">
    <h3 style="font-size: 0.95rem; margin-bottom: 0.5rem;">üìå Rappel</h3>
    <ul style="margin: 0; padding-left: 1.5rem; font-size: 0.9rem; color: var(--text-secondary, #6c757d);">
        <li><strong>TVA collect√©e</strong> (4431) : TVA factur√©e sur les ventes aux clients</li>
        <li><strong>TVA d√©ductible</strong> (4451) : TVA pay√©e sur les achats aux fournisseurs</li>
        <li><strong>TVA due</strong> = TVA collect√©e ‚àí TVA d√©ductible ‚Üí montant √† reverser √† l'√âtat</li>
        <li>Taux TVA Cameroun : 19,25% (19% + 1,25% CAC)</li>
    </ul>
</div>
{% endblock %}

